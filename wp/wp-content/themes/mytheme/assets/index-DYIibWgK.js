import{d as D,p as ae,r as y,q as le,g as ne,C as re,o as l,a as r,k as c,w as C,i as e,t as _,F as U,s as R,b as f,j as N,_ as M,D as ie,e as S,n as k,c as A,T as ue,E as j,G as ce,H as de,A as me,I as _e,J as ve,K as O,M as x,L as pe,N as fe,O as ge,Q as he}from"./index-Bxpq43On.js";import{u as Z,C as ye,f as $e}from"./CircleLinkItem-Bc7mb57A.js";import{u as Ce}from"./meta-DxkICGRB.js";import{B as be}from"./Breadcrumbs-DK2zOzf2.js";const Be={class:"CartItem"},Ie=["src"],ke={class:"CartItem__content"},Se={class:"CartItem__name"},De={key:0,class:"CartItem__categories"},Me={key:0,class:"CartItem__button"},Ne="https://placehold.jp/24/cccccc/ffffff/200x200.png?text=No Image",Pe=D({__name:"CartItem",props:{isNotDeleteButton:{type:Boolean},id:{},name:{},image:{},description:{},num:{},price:{},categories:{},tags:{}},setup(g){const o=ae(),h=Z(),n=g,i=y([]);return le(()=>n.categories,async a=>{if(a&&a.length>0)try{i.value=await o.getCategoryByIds(a),console.log("Fetched Categories:",i.value)}catch(p){console.error("Error fetching categories:",p)}else i.value=[]},{immediate:!0}),ne(async()=>{if(n.categories&&n.categories.length>0)try{i.value=await o.getCategoryByIds(n.categories),console.log("Fetched Categories on Mounted:",i.value)}catch(a){console.error("Error fetching categories on mounted:",a)}}),(a,p)=>{const t=re("router-link");return l(),r("div",Be,[c(t,{class:"CartItem__imageWrap",to:`/detail/${a.id}`,target:"_blank"},{default:C(()=>[e("img",{class:"CartItem__image",src:a.image?a.image:Ne,alt:""},null,8,Ie)]),_:1},8,["to"]),e("div",ke,[e("p",Se,_(a.name),1),i.value.length?(l(),r("ul",De,[(l(!0),r(U,null,R(i.value,d=>(l(),r("li",{key:d.id},[c(ye,{text:d.name,href:`/category/${d.id}`},null,8,["text","href"])]))),128))])):f("",!0)]),a.isNotDeleteButton?f("",!0):(l(),r("div",Me,[e("button",{class:"CartItem__delete",onClick:p[0]||(p[0]=d=>N(h).deleteItem(a.id))}," ×削除 ")]))])}}}),we=M(Pe,[["__scopeId","data-v-42953653"]]),Ee={class:"CartItems"},qe={key:0,class:"CartItems__items"},Te={key:1},Oe=D({__name:"CartItems",props:{items:{},isNotDeleteButton:{type:Boolean}},setup(g){return(o,h)=>(l(),r("div",Ee,[o.items&&o.items.length?(l(),r("ul",qe,[(l(!0),r(U,null,R(o.items,n=>(l(),r("li",{key:n.id,class:"CartItems__item"},[c(we,ie({ref_for:!0},n,{isNotDeleteButton:o.isNotDeleteButton}),null,16,["isNotDeleteButton"])]))),128))])):(l(),r("div",Te,"カートには何も入っていません"))]))}}),H=M(Oe,[["__scopeId","data-v-5bec7a68"]]),xe=["disabled"],ze=["src"],Ae=D({__name:"Button",props:{text:{},color:{default:"black"},size:{default:"s"},isActive:{type:Boolean},isDisabled:{type:Boolean},icon:{}},setup(g){return(o,h)=>(l(),r("button",{class:k(["Button",[`Button--${o.color}`,`Button--${o.size}`,{"Button--active":o.isActive,"Button--disabled":o.isDisabled}]]),disabled:!!o.isDisabled},[o.icon?(l(),r("img",{key:0,class:"Button__icon",src:o.icon,alt:""},null,8,ze)):f("",!0),S(" "+_(o.text),1)],10,xe))}}),I=M(Ae,[["__scopeId","data-v-859d3529"]]),Fe={class:"Modal__inner"},Ve={class:"Modal__header"},Le={class:"Modal__body"},je={class:"Modal__footer"},He=D({__name:"Modal",props:{title:{},size:{default:"l"},isShow:{type:Boolean}},emits:["close"],setup(g,{emit:o}){const h=o,n=()=>{h("close",!1)};return(i,a)=>(l(),A(ue,{name:"fade"},{default:C(()=>[i.isShow?(l(),r("section",{key:0,class:k(["Modal",[`Modal--${i.size}`]])},[e("div",{class:"Modal__overlay",onClick:a[0]||(a[0]=p=>n())}),e("div",Fe,[e("header",Ve,[e("h1",null,_(i.title),1),e("button",{class:"Modal__closeButton",onClick:a[1]||(a[1]=p=>n())}," × ")]),e("main",Le,[j(i.$slots,"body",{},void 0,!0)]),e("footer",je,[j(i.$slots,"footer",{},()=>[c(I,{text:"×閉じる",color:"gray",onClick:a[2]||(a[2]=p=>n())})],!0)])])],2)):f("",!0)]),_:3}))}}),z=M(He,[["__scopeId","data-v-50d2e613"]]),v=g=>(_e("data-v-79e2ac40"),g=g(),ve(),g),Ue={class:"Page"},Re=v(()=>e("h1",null,"カート",-1)),Ze={class:"Page__wrap"},Ge={class:"Page__itemsWrap"},Qe={key:0,class:"Page__order"},We=v(()=>e("p",null,"必要な情報をご入力ください。",-1)),Je={class:"table"},Ke=v(()=>e("colgroup",null,[e("col",{width:"30%"})],-1)),Xe=v(()=>e("th",null,[e("label",{for:"name"},[S("お名前"),e("span",{class:"hissu"},"必須")])],-1)),Ye={key:0,class:"Page__errorText"},et=v(()=>e("th",null,[e("label",{for:"email"},[S("メールアドレス"),e("span",{class:"hissu"},"必須")])],-1)),tt={key:0,class:"Page__errorText"},st=v(()=>e("label",{for:"qustion"},"ご質問等",-1)),ot={key:0,class:"Page__errorText"},at={class:""},lt={class:"Page__modalButtons"},nt=v(()=>e("p",null,"よろしければ注文してください。",-1)),rt={class:"table"},it=v(()=>e("colgroup",null,[e("col",{width:"30%"})],-1)),ut=v(()=>e("th",null,"お名前",-1)),ct=v(()=>e("th",null,"メールアドレス",-1)),dt=v(()=>e("th",null,"ご質問等",-1)),mt={class:"Page__modalButtons"},_t=v(()=>e("p",null,[S(" 何らかの理由で注文ができませんでした。"),e("br"),S("恐れ入りますが少し時間をおいてから再度お試しください。 ")],-1)),b=500,vt=D({__name:"index",setup(g){const o=ce();de(),Ce("カート","カート");const h=y([{text:"カート"}]),n=Z();console.log("cartStore.items",n.items);const i=y(!1),a=()=>{i.value=!0},p=()=>{i.value=!1},t=y({name:"",email:"",question:""}),d=y(""),G=()=>{if(d.value="",!t.value.name){d.value="お名前は必須項目です";return}},$=y(""),Q=()=>{if($.value="",!t.value.email){$.value="メールアドレスは必須項目です";return}if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t.value.email)){$.value="メールアドレスの形式が正しくありません";return}},F=m=>{m==="name"&&(d.value=""),m==="email"&&($.value="")},V=me(()=>!!(d.value||!t.value.name||$.value||!t.value.email||t.value.question.length>b)),P=y(!1),W=()=>{if(V.value)return!1;p(),P.value=!0},w=()=>{P.value=!1},E=y(!1),L=()=>{E.value=!0},J=()=>{E.value=!1,location.reload()},B=y(!1),K=async()=>{if(B.value)return!1;try{B.value=!0,w();const m=$e(new Date,"yyyyMMddHHmm");let s="";n.items.forEach(oe=>{s+=oe.name+`
`});const u=`注文番号：${m}`,X=`From: ${t.value.email}`,Y=`サイトから注文が来ました。

─ご注文内容の確認─────────────────
受付番号：${m}

ご注文商品：
${s}

[ お名前 ] ${t.value.name}
[ メールアドレス ] ${t.value.email}
[ ご質問等 ] 
${t.value.question}

──────────────────────────`,ee=`[${m}]ご注文ありがとうございます`,te=`From: ${t.value.email}`,se=`${t.value.name} 様
──────────────────────────

ご注文を承りました。
後程ご連絡させていただきますので今しばらくお待ちください。

─ご注文内容の確認─────────────────
受付番号：${m}

ご注文商品：
${s}

[ お名前 ] ${t.value.name}
[ メールアドレス ] ${t.value.email}
[ ご質問等 ] 
${t.value.question}

──────────────────────────`,q={orderItems:n.items,orderNo:m,email:t.value.email,name:t.value.name,question:t.value.question,toOrner:{subject:u,headers:X,body:Y},toCustomer:{subject:ee,headers:te,body:se},enviroment:fe};q[o.csrfToken.name]=o.csrfToken.value,console.log("postData:",q);const T=await ge.post(`${he}/send.php`,q,{headers:{"Content-Type":"text/plain"}});console.log("response:",T),T.status===200&&T.data.result?(n.deleteAllItem(),location.href="/cart/complete"):(L(),B.value=!1)}catch(m){console.error("注文処理中にエラーが発生しました:",m),L(),B.value=!1}};return(m,s)=>(l(),r("section",Ue,[h.value&&h.value.length?(l(),A(be,{key:0,items:h.value},null,8,["items"])):f("",!0),Re,e("div",Ze,[e("div",Ge,[c(H,{items:N(n).items},null,8,["items"])]),N(n).items.length?(l(),r("div",Qe,[e("button",{class:"Page__orderButton",onClick:s[0]||(s[0]=u=>a())}," この内容で注文する ")])):f("",!0)]),c(z,{isShow:i.value,title:"注文",size:"l",onClose:p},{body:C(()=>[We,e("table",Je,[Ke,e("tbody",null,[e("tr",null,[Xe,e("td",null,[O(e("input",{id:"name",class:k({error:d.value}),type:"text","onUpdate:modelValue":s[1]||(s[1]=u=>t.value.name=u),onFocus:s[2]||(s[2]=u=>F("name")),onBlur:s[3]||(s[3]=u=>G())},null,34),[[x,t.value.name]]),d.value?(l(),r("p",Ye,_(d.value),1)):f("",!0)])]),e("tr",null,[et,e("td",null,[O(e("input",{id:"email",class:k({error:$.value}),type:"email","onUpdate:modelValue":s[4]||(s[4]=u=>t.value.email=u),onFocus:s[5]||(s[5]=u=>F("email")),onBlur:s[6]||(s[6]=u=>Q())},null,34),[[x,t.value.email]]),$.value?(l(),r("p",tt,_($.value),1)):f("",!0)])]),e("tr",null,[e("th",null,[st,e("small",null,"※"+_(b)+"文字以内")]),e("td",null,[O(e("textarea",{id:"qustion",class:k(["Page__qustion",{error:t.value.question.length>b}]),"onUpdate:modelValue":s[7]||(s[7]=u=>t.value.question=u)},null,2),[[x,t.value.question]]),t.value.question.length>b?(l(),r("p",ot,_(b)+"文字を超えています ")):f("",!0),e("small",at,_(t.value.question.length)+"/"+_(b)+"文字",1)])])])])]),footer:C(()=>[e("div",lt,[c(I,{class:"Page__modalButton",text:"キャンセル",color:"gray",onClick:s[8]||(s[8]=u=>p())}),c(I,{class:"Page__modalButton",text:"確認",color:"blue",isDisabled:V.value,onClick:s[9]||(s[9]=u=>W())},null,8,["isDisabled"])])]),_:1},8,["isShow"]),c(z,{isShow:P.value,title:"注文確認",size:"l",onClose:w},{body:C(()=>[nt,e("table",rt,[it,e("tbody",null,[e("tr",null,[ut,e("td",null,_(t.value.name),1)]),e("tr",null,[ct,e("td",null,_(t.value.email),1)]),e("tr",null,[dt,e("td",null,[e("pre",null,_(t.value.question),1)])])])]),c(H,{items:N(n).items,isNotDeleteButton:""},null,8,["items"])]),footer:C(()=>[e("div",mt,[c(I,{class:"Page__modalButton",text:"キャンセル",color:"gray",onClick:s[10]||(s[10]=u=>w())}),c(I,{class:"Page__modalButton",text:"注文する",color:"blue",onClick:s[11]||(s[11]=u=>K())})])]),_:1},8,["isShow"]),c(z,{isShow:E.value,title:"注文エラー",size:"l",onClose:J},{body:C(()=>[_t]),_:1},8,["isShow"]),B.value?(l(),A(pe,{key:1,text:"送信中",isOverlay:""})):f("",!0)]))}}),yt=M(vt,[["__scopeId","data-v-79e2ac40"]]);export{yt as default};
